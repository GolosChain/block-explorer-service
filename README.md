# BLOCK-EXPLORER-SERVICE

**BLOCK-EXPLORER-SERVICE** является микросервисом роутинга запросов между фронтендом и микросервисами
блок эксплорера.
Для работы сервису необходим совместимый фронтенд-гейт, осуществляющий конечное общение с фронтендом.

##### API JSON-RPC

Общий формат всех входящих запросов из гейта должен строго соответствовать этому формату:

_(для внутренних запросов формат может быть любой, смотри также transfer в секции про внутренние запросы)_

```
routing:
    channelId <string>         // Идентификатор канала передачи данных,
                               // указывающий по какому каналу нужно будет передать ответ,
                               // актуально для запросов-подписок

    requestId <number|string>  // Идентификатор запроса в виде порядкового числа или уникальной строки,
                               // может использоваться для понимания очередности запросов
                               // или для запросов-подписок

_frontendGate <boolean>    // Флаг того что запрос был отправлен из фронтенд-гейта,
                           // необходим для автоматической фильтрации внешних запросов,
                           // которые не допустимы для внутренних методов

params <Object>            // Входящие параметры запроса, те самые параметры что попадают
                           // в фронтенд-гейт как входящий запрос, всё остальное выше
                           // определяется автоматически на уровне гейта
```

Апи для обращения из внутренних микросервисов:

```
transfer:                         // Переправить данные пользователю в виде JSON-RPC нотификации
    channelId <string>            // Идентификатор канала передачи данных
    method <string>               // Имя RPC метода
    error <Object|null>           // Объект ошибки (нет если есть result)
    result <Object|null>          // Объект данных (нет если есть error)
    _frontendGate <boolean|null>  // Флаг того что запрос был отправлен из гейта
                                  // В случае true - запрос будет заблокирован
```

### Переменные окружения

Возможные переменные окружения `ENV`:

-   `GLS_FRONTEND_GATE_CONNECT` _(обязательно)_ - адрес подключения к микросервису фронтенд-гейту.

-   `GLS_BLOCKS_CONNECT` _(обязательно)_ - адрес подключения к микросервису онлайн нотификаций.

-   `GLS_CONNECTOR_HOST` _(обязательно)_ - адрес, который будет использован для входящих подключений связи микросервисов.  
    Дефолтное значение при запуске без докера - `127.0.0.1`

-   `GLS_CONNECTOR_PORT` _(обязательно)_ - адрес порта, который будет использован для входящих подключений связи микросервисов.  
    Дефолтное значение при запуске без докера - `3000`, пересекается с `GLS_FRONTEND_GATE_PORT`

-   `GLS_METRICS_HOST` _(обязательно)_ - адрес хоста для метрик StatsD.  
    Дефолтное значение при запуске без докера - `127.0.0.1`

-   `GLS_METRICS_PORT` _(обязательно)_ - адрес порта для метрик.  
    Дефолтное значение при запуске без докера - `9777`

-   `GLS_MONGO_CONNECT` - строка подключения к базе MongoDB.  
    Дефолтное значение - `mongodb://mongo/admin`

-   `GLS_DAY_START` - время начала нового дня в часах относительно UTC.
    Дефолтное значение - `3` (день начинается в 00:00 по Москве).

### Запуск

Для запуска достаточно вызвать команду `docker-compose up` в корне проекта,
предварительно указав необходимые `ENV` переменные.
